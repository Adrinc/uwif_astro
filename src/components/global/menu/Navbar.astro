---
import { setURL } from "../../../data/constants";
import BotonFlecha from "../BotonFlecha.astro";
import Logo from "../animations/Rive/riveComponent.jsx";
import { getRelativeLocaleUrl } from 'astro:i18n';

interface Props {
    logo: any;
    options: any;
    featButton: any;
}

const { options, logo, featButton } = Astro.props;
const menuOpStyle="flex items-center transition ease-in-out delay-100 px-3 py-1 m-2 md:hover:scale-75  hover:text-gray-900 focus:text-gray-900 hover:bg-gray-200 focus:bg-gray-200 focus:outline-none focus:shadow-outline rounded-full font-semibold min-[1400px]:text-[1.2vw] text-[18px] tracking-[-0.5px]";
const astro=Astro;
---


<!-- component -->
<script
    src="https://cdn.jsdelivr.net/gh/alpinejs/alpine@v2.x.x/dist/alpine.min.js"
    defer>
</script>

<script>
    const nav = document.querySelector(".navbar");
    const navLinks = nav && nav.querySelectorAll("a");
    const currentURL = window.location.href;
    navLinks && navLinks.forEach((link) => {
      if (link.href === currentURL) {
        link.classList.add("active");
      }
    });
  </script>

<nav class="navbar" id="top">
    <div class="antialiased">
        <div
            class="w-full text-white bg-black/30 backdrop-blur-[20px] border-y border-white/20 py-3"
        >
            <div
                x-data="{ open: false }"
                class="z-10 flex flex-col max-w-screen-xl px-4 mx-auto md:items-center md:justify-between md:flex-row md:px-6 lg:px-8"
            >
                <div
                    class="flex flex-row items-center justify-between"
                >
                    <!-- LOGO -->

                    <a
                        href={getRelativeLocaleUrl(Astro.currentLocale==undefined?'en':Astro.currentLocale, logo.Link)}
                        class="w-[120px] h-[50px]"
                    >
                        <Logo src={setURL(logo.Icon.data.attributes.url)}, stateMachines={logo.Text} autoplay={true} transition:persist client:only/>    
                    </a
                    >
                   

                    <!-- HAMBURGER ICON -->
                    <button
                        class="rounded-lg md:hidden focus:outline-none focus:shadow-outline"
                        @click="open = !open"
                    >
                        <svg
                            fill="currentColor"
                            viewBox="0 0 20 20"
                            class="w-6 h-6"
                        >
                            <path
                                x-show="!open"
                                fill-rule="evenodd"
                                d="M3 5a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 10a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM9 15a1 1 0 011-1h6a1 1 0 110 2h-6a1 1 0 01-1-1z"
                                clip-rule="evenodd"></path>
                            <path
                                x-show="open"
                                fill-rule="evenodd"
                                d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z"
                                clip-rule="evenodd"></path>
                        </svg>
                    </button>
                </div>

                <!-- NAV BAR -->
                <nav
                    :class="{'flex': open, 'hidden': !open}"
                    class="w-full flex-col hidden pb-4 md:pb-0 md:flex md:justify-evenly md:flex-row text-white"
                >
                    <div
                        class="flex md:flex-row flex-col md:bg-white/5 md:rounded-full md:border md:border-white/10 text-white"
                    >

                    {options.map((button: any, index: number) => (
                        button.SubOptions.length === 0 ? 
                            <a
                                class={`${menuOpStyle} menuOption`}
                                href={getRelativeLocaleUrl(Astro.currentLocale==undefined?'en':Astro.currentLocale, button.Link)}>
                                {button.Text}
                            </a>
                            :
                            <div
                                @click.away="open = false"
                                class="relative"
                                x-data="{ open: false }"
                            >
                                <button
                                    @click="open = !open"
                                    class={`${menuOpStyle} gap-1`}
                                >
                                    <span>{button.Text}</span>
                                    <svg
                                        fill="currentColor"
                                        viewBox="0 0 20 20"
                                        :class="{'rotate-180': open, 'rotate-0': !open}"
                                        class="inline w-4 h-4 mt-1 transition-transform duration-200 transform md:-mt-0"
                                    >
                                        <path
                                            fill-rule="evenodd"
                                            d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z"
                                            clip-rule="evenodd">
                                        </path>
                                    </svg>
                                </button>
                            <div
                                x-show="open"
                                x-transition:enter="transition ease-out duration-100"
                                x-transition:enter-start="transform opacity-0 scale-95"
                                x-transition:enter-end="transform opacity-100 scale-100"
                                x-transition:leave="transition ease-in duration-75"
                                x-transition:leave-start="transform opacity-100 scale-100"
                                x-transition:leave-end="transform opacity-0 scale-95"
                                class="absolute right-0 w-full md:max-w-[180px] md:w-screen mt-2 origin-top-right z-20"
                            >
                                <div
                                    class="bg-white rounded-md shadow-lg dark-mode:bg-gray-700 divide-y"
                                >
                                {button.SubOptions.map((suboption: any, index: number) => (
                                    <a
                                class={`${menuOpStyle} text-black md:text-[15px] menuOption`}
                                href={getRelativeLocaleUrl(Astro.currentLocale==undefined?'en':Astro.currentLocale, suboption.Link)}>{suboption.Text}</a>
                                ))}
                                
                                </div>
                            </div>
                        </div>
                        ))
                    }
                    </div>
                </nav>
                <div
                    :class="{'flex': open, 'hidden': !open}"
                    class="md:block hidden w-[120px]"
                >
                    <BotonFlecha
                        texto={featButton.Text}
                        link={featButton.Link}
                        backgroundColor={"var(--primary-color)"}
                        iconColor={`var(--primary-text-color)`}
                        iconBackgroundColor={"var(--primary-color)"}
                    />
                </div>
                <div id="switch-lang" class="relative flex cursor-pointer items-center justify-center self-center rounded-full shadow-sm bg-secondaryColor p-2 ml-5">
                    <div class=`h-[35px] w-[35px] rounded-full text-center ${Astro.currentLocale =="es"?"opacity-50":""}`>EN</div>
                    <div class=`h-[35px] w-[35px] rounded-full text-center ${Astro.currentLocale =="en"?"opacity-50":""}`>ES</div>
                </div>
            </div>
        </div>
    </div>
</nav>

<script>
    const switchLang = document.getElementById('switch-lang');

    switchLang?.addEventListener('click', ()=>{
        console.log("click")
        console.log(window.location.pathname);
        let newPath
        window.location.pathname.includes('/es/')
        ?newPath = "/"+window.location.pathname.split('/es/')[1]
        :newPath="/es"+window.location.pathname;

        window.location.href=newPath;
    })
</script>

<style>
    .navbar a.menuOption.active {
        border: solid white;
    }
</style>